<app-page-header title="Personal Data" [showBackButton]="false" ></app-page-header>

<div class="personal-info-page-container"> <!-- main page container -->
  <div class="form-content-wrapper"> <!-- Centered content with max width -->
    <form [formGroup]="personalInfoForm" (ngSubmit)="onSave()" novalidate class="personal-info-form">
      <!-- Name Field -->
      <div class="form-field-group">
        <label class="form-field-label" for="name-input-pi">Name</label>
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Enter your name</mat-label>
          <input matInput id="name-input-pi" formControlName="name" required>
          @if (personalInfoForm.get('name')?.hasError('required') && personalInfoForm.get('name')?.touched) {
            <mat-error>Name is required.</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Date of Birth Field -->
      <div class="form-field-group">
        <label class="form-field-label" for="dob-input-pi">Date of Birth</label>
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Select your date of birth</mat-label>
          <input matInput id="dob-input-pi" formControlName="dateOfBirth" type="date" required>
          <mat-icon matSuffix>calendar_today</mat-icon>
          @if (personalInfoForm.get('dateOfBirth')?.hasError('required') && personalInfoForm.get('dateOfBirth')?.touched) {
            <mat-error>Date of Birth is required.</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Email Field -->
      <div class="form-field-group">
        <label class="form-field-label" for="email-input-pi">Email</label>
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Enter your email</mat-label>
          <input matInput id="email-input-pi" formControlName="email" type="email" required>
           @if (personalInfoForm.get('email')?.hasError('required') && personalInfoForm.get('email')?.touched && personalInfoForm.get('email')?.enabled) {
            <mat-error>Email is required.</mat-error>
          }
          @if (personalInfoForm.get('email')?.hasError('email') && personalInfoForm.get('email')?.touched && personalInfoForm.get('email')?.enabled) {
            <mat-error>Please enter a valid email.</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Password and Repeat Password fields are REMOVED -->

      <!-- Gender Field -->
      <div class="form-field-group">
        <label class="form-field-label" for="gender-select-pi">Gender</label>
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Select your gender</mat-label>
          <mat-select id="gender-select-pi" formControlName="gender" required>
            @for (option of genderOptions; track option.value) {
              <mat-option [value]="option.value">{{option.viewValue}}</mat-option>
            }
          </mat-select>
           @if (personalInfoForm.get('gender')?.hasError('required') && personalInfoForm.get('gender')?.touched) {
            <mat-error>Gender is required.</mat-error>
          }
        </mat-form-field>
      </div>
    </form>

    <!-- Addresses Section -->
    <h3 class="section-title">Añade direcciones donde quieres que recojamos tus vehículos</h3>
    <mat-list role="list" class="address-list">
      @for (address of addresses(); track address.id; let isLast = $last) {
        <app-list-item
          [iconName]="address.iconName"
          [title]="address.title"
          [subtitle]="address.subtitle"
          [isClickable]="true"
          [showTrailingIcon]="true"
          (itemClick)="onEditAddress(address.id)"
          [showDivider]="!isLast">
        </app-list-item>
      } @empty {
        <p class="empty-list-message">No addresses found. You can add one below.</p>
      }
    </mat-list>
  </div>

  <!-- Sticky Footer Area for Actions -->
  <div class="footer-actions-container">
    <div class="footer-actions-wrapper">
      <button matButton="tonal"   (click)="onAddAddress()" class="action-button add-address-button">
        Add Address
      </button>
      <button matButton="filled"  (click)="onSave()" class="action-button save-button">
        Save
      </button>
    </div>
  </div>
</div>